version: "3.8"

services:
  db:
    image: mysql:5.7
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: wordpress
      MYSQL_DATABASE: wordpress
      MYSQL_USER: wordpress
      MYSQL_PASSWORD: wordpress
    volumes:
      - db_data:/var/lib/mysql
  wordpress:
    depends_on:
      - db
    image: wordpress:latest
    ports:
      - "127.0.0.1:80:80"
      - "127.0.0.1:443:443"
    restart: always
    environment:
      WORDPRESS_DB_HOST: db:3306
      WORDPRESS_DB_USER: wordpress
      WORDPRESS_DB_PASSWORD: wordpress
      WORDPRESS_DB_NAME: wordpress
    working_dir: /var/www/html
    volumes:
      - /srv/http/docker-wordpress.test/htdocs/wp-content:/var/www/html/wp-content
      - /srv/http/docker-wordpress.test/htdocs/uploads.ini:/usr/local/etc/php/conf.d/uploads.ini
  phpmyadmin:
    depends_on:
      - db
    image: phpmyadmin:latest
    ports:
      - "127.0.0.1:8080:80"
    restart: always
    environment:
      PMA_HOST: db
      MYSQL_ROOT_PASSWORD: wordpress
volumes:
  db_data:

#version: '3.9'
#
#services:
#  mariadb:
#    container_name: mariadb
#    build:
#      context: ./requirements/mariadb
#      dockerfile: Dockerfile
#    env_file: .env
#    volumes:
#      - mariadb:/var/lib/mysql
#    networks:
#      - inception
#    restart: always
#
#  wordpress:
#    container_name: wordpress
#    build:
#      context: requirements/nginx
#      dockerfile: Dockerfile
#    env_file: .env
#    volumes:
#      - wordpress:/var/www/nginx
#    networks:
#      - inception
#    depends_on:
#      - mariadb
#    restart: on-failure
#
#  nginx:
#    container_name: nginx
#    build:
#      context: requirements/nginx
#      dockerfile: Dockerfile
#    env_file: .env
#    volumes:
#      - wordpress:/var/www/wordpress
#    networks:
#      - inception
#    depends_on:
#      - wordpress
#    ports:
#      - "443:443"
#    restart: on-failure
#
#volumes:
#  mariadb:
#       driver: local
#       driver_opts:
#         type: 'none'
#         o: 'bind'
#         device: '/Users/$USER/data/mariadb'
#
#  wordpress:
#      driver: local
#      driver_opts:
#        type: 'none'
#        o: 'bind'
#        device: '/Users/$USER/data/wordpress'
#    
#networks:
#  inception:
#    driver: bridge
